# Default values for flowker components.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
nameOverride: "flowker"
fullnameOverride: ""
namespaceOverride: "flowker"

flowker:
  # -- Service name
  name: flowker

  # -- Service description
  description: "Workflow orchestration platform for financial validation"

  # -- Enable or disable the flowker service
  enabled: true

  # -- Number of replicas for the flowker service
  replicaCount: 1

  # -- Number of old ReplicaSets to retain for deployment rollback
  revisionHistoryLimit: 10

  image:
    # -- Repository for the flowker service container image
    repository: ghcr.io/lerianstudio/flowker
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Image tag used for deployment
    tag: "1.0.0-beta.22"

  # -- Secrets for pulling images from a private registry
  imagePullSecrets: []
  # -- Overrides the default generated name by Helm
  nameOverride: ""
  # -- Overrides the full name generated by Helm
  fullnameOverride: ""

  # -- Pod annotations for additional metadata
  podAnnotations: {}

  podSecurityContext: {}
    # fsGroup: 2000

  securityContext:
    # -- Defines the group ID for the user running the process inside the container
    runAsGroup: 1000
    # -- Defines the user ID for the process running inside the container
    runAsUser: 1000
    # -- Ensures the process does not run as root
    runAsNonRoot: true
    capabilities:
      drop:
        - ALL
    # -- Defines the root filesystem as read-only
    readOnlyRootFilesystem: true

  # -- PodDisruptionBudget configuration
  pdb:
    # -- Enable or disable PodDisruptionBudget
    enabled: true
    # -- Minimum number of available pods (cannot be set together with maxUnavailable)
    minAvailable: 1
    # -- Maximum number of unavailable pods (cannot be set together with minAvailable)
    maxUnavailable: ""
    # -- Annotations for the PodDisruptionBudget
    annotations: {}

  # -- Deployment update strategy
  deploymentUpdate:
    # -- Type of deployment strategy
    type: RollingUpdate
    # -- Maximum number of pods that can be created over the desired number of pods
    maxSurge: 1
    # -- Maximum number of pods that can be unavailable during the update
    maxUnavailable: 1

  service:
    # -- Kubernetes service type
    type: ClusterIP
    # -- Port for the HTTP API
    port: 4000
    annotations: {}

  ingress:
    # -- Enable or disable ingress
    enabled: false
    # -- Ingress class name
    className: ""
    # -- Additional ingress annotations
    annotations: {}
    hosts:
      - host: ""
        paths:
          - path: /
            pathType: Prefix
    # -- TLS configuration for ingress
    tls: []
    #  - secretName: chart-example-tls
    #    hosts:
    #      - chart-example.local

  resources:
    # -- CPU and memory limits for pods
    limits:
      cpu: 500m
      memory: 512Mi
    # -- Minimum CPU and memory requests
    requests:
      cpu: 100m
      memory: 128Mi

  autoscaling:
    # -- Enable or disable horizontal pod autoscaling
    enabled: true
    # -- Minimum number of replicas
    minReplicas: 1
    # -- Maximum number of replicas
    maxReplicas: 5
    # -- Target CPU utilization percentage for autoscaling
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

  # -- Node selector for scheduling pods on specific nodes
  nodeSelector: {}

  # -- Tolerations for scheduling on tainted nodes
  tolerations: {}

  # -- Affinity rules for pod scheduling
  affinity: {}

  # -- ConfigMap for environment variables and configurations
  # @default -- templates/configmap.yaml
  configmap:
    # Server
    ENV_NAME: "development"
    VERSION: "v1.0.0"
    SERVER_PORT: "4000"
    SERVER_ADDRESS: ":4000"

    # Logging
    LOG_LEVEL: "info"

    # Authentication
    API_KEY_ENABLED: "false"

    # CORS
    CORS_ALLOWED_ORIGINS: "*"

    # MongoDB
    MONGO_URI: "mongodb://flowker:lerian@flowker-mongodb:27017/flowker?authSource=admin"
    MONGO_HOST: "flowker-mongodb"
    MONGO_PORT: "27017"
    MONGO_DB_NAME: "flowker"
    MONGO_APP_USER: "flowker"
    MONGO_MAX_POOL_SIZE: "10"
    MONGO_MIN_POOL_SIZE: "5"
    MONGO_MAX_IDLE_TIME_MS: "60000"
    MONGO_CONNECT_TIMEOUT_MS: "10000"
    MONGO_SOCKET_TIMEOUT_MS: "30000"

    # Swagger Documentation
    SWAGGER_TITLE: "Flowker API"
    SWAGGER_DESCRIPTION: "Workflow orchestration platform for financial validation"
    SWAGGER_VERSION: "v1.0.0"
    SWAGGER_HOST: ":4000"
    SWAGGER_BASE_PATH: "/"
    SWAGGER_SCHEMES: "http"
    SWAGGER_LEFT_DELIM: "{{"
    SWAGGER_RIGHT_DELIM: "}}"

    # OpenTelemetry
    # -- Enable telemetry collection (when true, OTEL_EXPORTER_OTLP_ENDPOINT is overridden with HOST_IP:4317)
    ENABLE_TELEMETRY: "false"
    # -- OTEL resource service name for traces/metrics
    OTEL_RESOURCE_SERVICE_NAME: "flowker"
    # -- OTEL library name for instrumentation
    OTEL_LIBRARY_NAME: "github.com/LerianStudio/flowker"
    # -- OTEL resource service version
    OTEL_RESOURCE_SERVICE_VERSION: "v1.0.0"
    # -- OTEL resource deployment environment
    OTEL_RESOURCE_DEPLOYMENT_ENVIRONMENT: "development"
    # -- OTEL exporter endpoint port
    OTEL_EXPORTER_OTLP_ENDPOINT_PORT: "4317"
    # -- OTEL exporter endpoint (empty when disabled; overridden by HOST_IP:4317 when ENABLE_TELEMETRY=true)
    OTEL_EXPORTER_OTLP_ENDPOINT: ""

  # -- Secrets for storing sensitive data
  # @default -- templates/secrets.yaml
  secrets:
    # -- MongoDB application password
    MONGO_APP_PASSWORD: "lerian"
    # -- API Key secret (if API_KEY_ENABLED is true)
    API_KEY: ""

  # -- Use an existing secret instead of creating one
  useExistingSecret: false
  # -- Name of the existing secret to use
  existingSecretName: ""

  # -- Extra environment variables
  extraEnvVars: []

  serviceAccount:
    # -- Specifies whether a ServiceAccount should be created
    create: true
    # -- Annotations for the ServiceAccount
    annotations: {}
    # -- Name of the service account
    # @default -- `flowker.fullname`
    name: ""

mongodb:
  # MongoDB document database for flowker data storage
  enabled: true

  global:
    security:
      allowInsecureImages: true

  image:
    repository: bitnamisecure/mongodb
    tag: "latest"

  external: false
  auth:
    enabled: true
    rootUser: flowker
    rootPassword: "lerian"

  resourcesPreset: "medium"

  persistence:
    size: 8Gi
