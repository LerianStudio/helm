apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "plugin-br-pix-direct-jd-job.fullname" . }}
  labels:
    {{- include "plugin-br-pix-direct-jd-job.labels" (dict "context" . "name" .Values.job.name ) | nindent 4 }} 
data:
  # -- Default Environment variables for the plugin-br-pix-direct-jd
  NODE_ENV: {{ .Values.job.configmap.NODE_ENV | default "development" | quote }}
  DEBUG: {{ .Values.job.configmap.DEBUG | default "false" | quote }}

  # APP
  APPLICATION_NAME: {{ .Values.job.configmap.APPLICATION_NAME | default "plugin-br-pix-direct-jd" | quote }}
  APPLICATION_BASE_URL: {{ .Values.job.configmap.APPLICATION_BASE_URL | default "http://plugin-br-pix-direct-jd:4011" | quote }}
  API_VERSION: {{ .Values.job.configmap.API_VERSION | default "1.0.0" | quote }}
  API_PORT: {{ .Values.job.configmap.API_PORT | default "4011" | quote }}
  API_RATE_CRITICAL_MAX: {{ .Values.job.configmap.API_RATE_CRITICAL_MAX | default "5" | quote }}
  API_RATE_CRITICAL_WINDOW: {{ .Values.job.configmap.API_RATE_CRITICAL_WINDOW | default "1" | quote }}
  API_RATE_ENABLED: {{ .Values.job.configmap.API_RATE_ENABLED | default "false" | quote }}
  API_RATE_GENERAL_MAX: {{ .Values.job.configmap.API_RATE_GENERAL_MAX | default "20" | quote }}
  API_RATE_GENERAL_WINDOW: {{ .Values.job.configmap.API_RATE_GENERAL_WINDOW | default "1" | quote }}
  API_RATE_ONBOARD_MAX: {{ .Values.job.configmap.API_RATE_ONBOARD_MAX | default "10" | quote }}
  API_RATE_ONBOARD_WINDOW: {{ .Values.job.configmap.API_RATE_ONBOARD_WINDOW | default "1" | quote }}

  # JOBS
  JOBS_CRON_TRANSACTIONS: {{ .Values.job.configmap.JOBS_CRON_TRANSACTIONS | default "*/10 * * * *" | quote }}
  JOBS_CRON: {{ .Values.job.configmap.JOBS_CRON | default "*/10 * * * *" | quote }}
  JOBS_CRON_PROCESS_CSM: {{ .Values.job.configmap.JOBS_CRON_PROCESS_CSM | default "*/1 * * * *" | quote }}
  JOBS_CRON_TRANSACTIONS_NON_PRIORITY: {{ .Values.job.configmap.JOBS_CRON_TRANSACTIONS_NON_PRIORITY | default "*/1 * * * *" | quote }}

  # Integration
  CORE_BANK_SERVER: {{ .Values.job.configmap.CORE_BANK_SERVER | default "midaz" | quote }}
  CORE_PIX_SERVER: {{ .Values.job.configmap.CORE_PIX_SERVER | default "jd" | quote }}

  # JD Pix Integration Configuration
  JD_BASE_URL: {{ .Values.job.configmap.JD_BASE_URL | default "http://jd-pix.midaz-plugins.svc.cluster.local:3000" | quote }}
  JD_CLIENT_ID: {{ .Values.job.configmap.JD_CLIENT_ID | default "" | quote }}
  JD_GRANT_TYPE: {{ .Values.job.configmap.JD_GRANT_TYPE | default "client_credentials" | quote }}
  JD_BANK_ID: {{ .Values.job.configmap.JD_BANK_ID | default "37040044" | quote }}

  # Database
  DATABASE_ACQUIRE: {{ .Values.pix.configmap.DATABASE_ACQUIRE | default "10000" | quote }}
  DATABASE_HOST: {{ .Values.pix.configmap.DATABASE_HOST | default "plugin-br-pix-direct-jd-postgresql.midaz-plugins.svc.cluster.local" | quote }}
  DATABASE_IDLE: {{ .Values.pix.configmap.DATABASE_IDLE | default "20000" | quote }}
  DATABASE_USER: {{ .Values.pix.configmap.DATABASE_USER | default "pix" | quote }}
  DATABASE_NAME: {{ .Values.pix.configmap.DATABASE_NAME | default "pix" | quote }}
  DATABASE_POOL_MAX: {{ .Values.pix.configmap.DATABASE_POOL_MAX | default "10" | quote }}
  DATABASE_POOL_MIN: {{ .Values.pix.configmap.DATABASE_POOL_MIN | default "1" | quote }}
  DATABASE_PORT: {{ .Values.pix.configmap.DATABASE_PORT | default "5432" | quote }}

  # AUTH CONFIGS - Access Manager (OAuth2)
  PLUGIN_AUTH_ENABLED: {{ .Values.job.configmap.PLUGIN_AUTH_ENABLED | default "false" | quote }}
  PLUGIN_AUTH_HOST: {{ .Values.job.configmap.PLUGIN_AUTH_HOST | default "http://plugin-access-manager-auth.midaz-plugins.svc.cluster.local:4000" | quote }}

  # Midaz
  MIDAZ_ORGANIZATION_ID: {{ .Values.job.configmap.MIDAZ_ORGANIZATION_ID | default "" | quote }}
  MIDAZ_LEDGER_ID: {{ .Values.job.configmap.MIDAZ_LEDGER_ID | default "" | quote }}
  MIDAZ_ASSET_ID: {{ .Values.job.configmap.MIDAZ_ASSET_ID | default "1" | quote }}
  MIDAZ_EXTERNAL_ID: {{ .Values.job.configmap.MIDAZ_EXTERNAL_ID | default "" | quote }}
  MIDAZ_TIMEOUT: {{ .Values.job.configmap.MIDAZ_TIMEOUT | default "30000" | quote }}
  MIDAZ_URL_ONBOARDING: {{ .Values.job.configmap.MIDAZ_URL_ONBOARDING | default "http://midaz-onboarding.midaz.svc.cluster.local:3000" | quote }}
  MIDAZ_URL_TRANSACTION: {{ .Values.job.configmap.MIDAZ_URL_TRANSACTION | default "http://midaz-transaction.midaz.svc.cluster.local:3001" | quote }}

  # CRM
  CRM_URL: {{ .Values.job.configmap.CRM_URL | default "http://plugin-crm.midaz-plugins.svc.cluster.local:4003" | quote }}

  # JD Pix Configuration
  JD_JD_PIX_URL: {{ .Values.pix.configmap.JD_JD_PIX_URL | default "" | quote }}
  JD_BASE_URL: {{ .Values.pix.configmap.JD_BASE_URL | default "http://jd-mock-api.jd-mock.svc.cluster.local:4013" | quote }}
  JD_GRANT_TYPE: {{ .Values.pix.configmap.JD_GRANT_TYPE | default "client_credentials" | quote }}

  # OpenTelemetry - Shared Midaz LGTM Infrastructure
  OTEL_RESOURCE_SERVICE_NAME: {{ .Values.job.configmap.OTEL_RESOURCE_SERVICE_NAME | default "plugin-br-pix-direct-jd" | quote }}
  OTEL_RESOURCE_SERVICE_VERSION: {{ .Values.job.configmap.OTEL_RESOURCE_SERVICE_VERSION | default "1.0.0" | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT_PORT: {{ .Values.job.configmap.OTEL_EXPORTER_OTLP_ENDPOINT_PORT | default "4317" | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.job.configmap.OTEL_EXPORTER_OTLP_ENDPOINT | default "midaz-otel-lgtm:4317" | quote }}
  ENABLE_TELEMETRY: {{ .Values.job.configmap.ENABLE_TELEMETRY | default "true" | quote }}

  # Twilio Configuration
  TWILIO_PHONE_NUMBER: {{ .Values.job.configmap.TWILIO_PHONE_NUMBER | default "your-twilio-phone-number" | quote }}
  TWILIO_EMAIL_FROM: {{ .Values.job.configmap.TWILIO_EMAIL_FROM | default "your-twilio-email-from" | quote }}
  TWILIO_SMS_TEMPLATE_VERIFICATION: {{ .Values.job.configmap.TWILIO_SMS_TEMPLATE_VERIFICATION | default "Your verification code is: {code}" | quote }}

  # SendGrid Configuration
  SENDGRID_FROM_EMAIL: {{ .Values.job.configmap.SENDGRID_FROM_EMAIL | default "noreply@yourcompany.com" | quote }}
  SENDGRID_FROM_TEMPLATE: {{ .Values.job.configmap.SENDGRID_FROM_TEMPLATE | default "your-template-id" | quote }}
  MOCK_TOKEN: {{ .Values.job.configmap.MOCK_TOKEN | default "false" | quote }}

  # Extra Env Vars
  {{- with .Values.job.extraEnvVars }}
  {{- toYaml . | nindent 2 }}
  {{- end }}