apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "midaz-console.fullname" . }}-nginx-config-plugins
data:
  plugins.conf: |-
{{- if eq .Chart.Name "midaz-helm" }}
{{- range $name, $plugin := .Values.console.pluginsUi }}
{{- if and (kindIs "map" $plugin) $plugin.enabled }}
{{-   $context := dict "name" $name "port" $plugin.port }}
{{ tpl (include "nginx.pluginServerBlock" $context) $ | indent 4 }}
{{- end }}
{{- end }}
{{- end }}