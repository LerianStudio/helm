name: Generate Changelog

# This workflow generates CHANGELOG.md using GPTChangelog
# Triggered on tag pushes to generate AI-powered release notes
#
# Features:
# - Generates CHANGELOG.md with AI-powered summaries for each chart
# - Updates GitHub Release notes
# - Creates PR with changelog updates
# - Supports monorepo structure (charts/)

on:
  push:
    tags:
      - '**-v*'  # Matches: midaz-v1.0.0, fetcher-v1.0.0, reporter-v2.1.0, etc.

permissions:
  contents: write
  pull-requests: write

jobs:
  changelog:
    uses: LerianStudio/github-actions-shared-workflows/.github/workflows/gptchangelog.yml@main
    with:
      runner_type: "blacksmith-4vcpu-ubuntu-2404"
      filter_paths: |-
        charts/fetcher
        charts/midaz
        charts/otel-collector-lerian
        charts/plugin-access-manager
        charts/plugin-br-pix-direct-jd
        charts/plugin-br-pix-indirect-btg
        charts/plugin-crm
        charts/plugin-fees
        charts/product-console
        charts/reporter
      path_level: '2'
    secrets: inherit
