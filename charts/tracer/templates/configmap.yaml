{{- if .Values.tracer.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tracer.fullname" . }}
  namespace: {{ include "global.namespace" . }}
  labels:
    {{- include "tracer.labels" (dict "context" . "component" .Values.tracer.name "name" .Values.tracer.name) | nindent 4 }}
data:
  # Application Configuration
  SERVER_PORT: {{ .Values.tracer.configmap.SERVER_PORT | default "8080" | quote }}
  SERVER_ADDRESS: {{ .Values.tracer.configmap.SERVER_ADDRESS | default ":8080" | quote }}

  # Logging
  LOG_LEVEL: {{ .Values.tracer.configmap.LOG_LEVEL | default "info" | quote }}

  # Authentication
  API_KEY_ENABLED: {{ .Values.tracer.configmap.API_KEY_ENABLED | default "false" | quote }}

  # CORS
  CORS_ALLOWED_ORIGINS: {{ .Values.tracer.configmap.CORS_ALLOWED_ORIGINS | default "*" | quote }}

  # Auth Plugin (Access Manager)
  PLUGIN_AUTH_ENABLED: {{ .Values.tracer.configmap.PLUGIN_AUTH_ENABLED | default "false" | quote }}
  PLUGIN_AUTH_HOST: {{ .Values.tracer.configmap.PLUGIN_AUTH_HOST | default "http://plugin-auth:4000" | quote }}

  # PostgreSQL Database
  DB_HOST: {{ .Values.tracer.configmap.DB_HOST | default "tracer-postgresql" | quote }}
  DB_PORT: {{ .Values.tracer.configmap.DB_PORT | default "5432" | quote }}
  DB_NAME: {{ .Values.tracer.configmap.DB_NAME | default "tracer" | quote }}
  DB_USER: {{ .Values.tracer.configmap.DB_USER | default "tracer" | quote }}
  DB_SSL_MODE: {{ .Values.tracer.configmap.DB_SSL_MODE | default "disable" | quote }}
  MIGRATIONS_PATH: {{ .Values.tracer.configmap.MIGRATIONS_PATH | default "./migrations" | quote }}

  # Swagger Documentation
  SWAGGER_TITLE: {{ .Values.tracer.configmap.SWAGGER_TITLE | default "Tracer API" | quote }}
  SWAGGER_DESCRIPTION: {{ .Values.tracer.configmap.SWAGGER_DESCRIPTION | default "Real-time transaction validation and fraud prevention API" | quote }}
  SWAGGER_HOST: {{ .Values.tracer.configmap.SWAGGER_HOST | default ":8080" | quote }}
  SWAGGER_BASE_PATH: {{ .Values.tracer.configmap.SWAGGER_BASE_PATH | default "/" | quote }}
  SWAGGER_SCHEMES: {{ .Values.tracer.configmap.SWAGGER_SCHEMES | default "http" | quote }}

  # CEL Expression Engine
  CEL_CACHE_MAX_SIZE: {{ .Values.tracer.configmap.CEL_CACHE_MAX_SIZE | default "1000" | quote }}
  CEL_COST_LIMIT: {{ .Values.tracer.configmap.CEL_COST_LIMIT | default "10000" | quote }}

  # OpenTelemetry (Observability)
  OTEL_RESOURCE_SERVICE_NAME: {{ .Values.tracer.configmap.OTEL_RESOURCE_SERVICE_NAME | default "tracer" | quote }}
  OTEL_LIBRARY_NAME: {{ .Values.tracer.configmap.OTEL_LIBRARY_NAME | default "github.com/LerianStudio/tracer" | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.tracer.configmap.OTEL_EXPORTER_OTLP_ENDPOINT | default "" | quote }}
  ENABLE_TELEMETRY: {{ .Values.tracer.configmap.ENABLE_TELEMETRY | default "false" | quote }}

  # Cleanup Worker
  CLEANUP_WORKER_ENABLED: {{ .Values.tracer.configmap.CLEANUP_WORKER_ENABLED | default "false" | quote }}
  CLEANUP_INTERVAL_HOURS: {{ .Values.tracer.configmap.CLEANUP_INTERVAL_HOURS | default "24" | quote }}
  CLEANUP_RETENTION_DAYS: {{ .Values.tracer.configmap.CLEANUP_RETENTION_DAYS | default "90" | quote }}

  # Extra Env Vars
  {{- with .Values.tracer.extraEnvVars }}
  {{- range . }}
  {{ .name }}: {{ .value | quote }}
  {{- end }}
  {{- end }}
{{- end }}
